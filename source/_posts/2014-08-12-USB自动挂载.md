title: USB自动挂载
date: 2014-08-13 00:51:41
tags:
---
## /etc/hotplug.d/usb/10-usb ##
```
#!/bin/sh

# Copyright (C) 2009 OpenWrt.org

case "$ACTION" in
	add)
		# update LEDs
		echo "############## INTO 10-usb add ###############" >> /tmp/10-usb.log
		/sbin/inner_usbcheck start
		;;
	remove)
		echo "############## INTO 10-usb remove ###############" >> /tmp/10-usb.log
		# update LEDs
		;;
esac	
```

## cat /sbin/inner_usbcheck ##

```
#!/bin/sh /etc/rc.common
# Copyright (C) 2006 OpenWrt.org
START=80

mount_dir_1="/tmp/mnt/log/"
 
make_dir()
{
	myPath=$mount_dir_1
	if [ ! -d "$myPath" ]; then
		mkdir -p "$myPath"
		echo "make dir $myPath" >> /tmp/inner_usbcheck.log
	fi
}
get_dev()
{
	blkid |grep LOG_MAIN | awk '{print $1}' > /tmp/usb_mount.txt
	while read line
	do
	{
		echo ${line}
		tmp=${line}
		tmp=${tmp##*dev\/}
		tmp=${tmp%%:*}
		if [ $num1 -eq $flag ]
		then
			dev1=$tmp
			echo $dev1
			flag=2
		fi
	}
	done < /tmp/usb_mount.txt
	
	rm -rf /tmp/usb_mount.txt
}

mount_dev()
{
	umount /dev/$dev1
	mount /dev/$dev1 $mount_dir_1
}

start() {
	touch /tmp/usb_mount.txt
	make_dir
	get_dev
	mount_dev
}
```
